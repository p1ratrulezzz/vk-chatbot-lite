!function(){function t(){var t=f.shift(),n=l.value;t&&n&&i&&!s.test(n)&&o("captcha.send",{auth_key:i.authKey,captcha_bot_id:t.botId,captcha_sid:t.sid,captcha_key:n,user_id:i.id},function(t,n){l.value="",e()})}function e(){f.length?(n("show"),h.setAttribute("src","/api/captcha.image?sid="+f[0].sid)):n("hide")}function n(t){r.classList["show"===t?"remove":"add"]("is-empty"),u.style.display="show"===t?"table-cell":"none",d.style.display="show"===t?"none":"block"}function c(){o("captcha.getAll",function(t,n){t||(f=[],n.forEach(function(t){t[1].forEach(function(e){f.push({botId:t[0],sid:e})})}),e())})}function a(){var t=location.search.slice(1);if(t){var e=t.match(/viewer_id=([^&]+)/);e=e&&e[1];var n=t.match(/auth_key=([^&]+)/);n=n&&n[1],e&&n&&(i={authKey:n,id:e})}}function o(t,e,n){var c="https://botsforchats.ru/api/"+t;"function"==typeof e&&(n=e,e=void 0);var a=new XMLHttpRequest;e&&(c+="?",Object.keys(e).forEach(function(t){c+=t+"="+encodeURIComponent(e[t])+"&"}),c.endsWith("&")&&(c=c.slice(0,-1))),a.open("get",c,!0),a.onload=function(){var t=a.status;if(t>=200&&t<=399)try{var e=JSON.parse(a.responseText);return!0===e.ok?n(null,e.response):!1===e.ok?n(e.cause):n(null,e)}catch(t){return n("JSON.parse Error")}else n("Status Code Error")},a.onerror=function(){n("Network Error")},a.send()}var i,s=/[^a-zа-яё0-9]/i,r=document.getElementById("captcha-container"),u=document.getElementById("captcha-block"),d=document.getElementById("captcha-empty-block"),h=document.getElementById("captcha-img"),l=document.getElementById("captcha-input"),p=document.getElementById("captcha-send-button"),f=[];a(),l.addEventListener("keyup",function(e){"Enter"===e.key&&t()}),p.addEventListener("click",t),c(),setInterval(c,15e3)}();
